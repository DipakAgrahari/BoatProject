let express = require('express');
let router = express.Router();
const { randomUUID } = require('crypto'); // Added in: node v14.17.0

const BusinessModel = require('../models/owner')
const authMiddleware = require('../middlewares/auth')

router.post("/addBoat", authMiddleware, (req, res) => {
    console.log(req.user)
    console.log(randomUUID());

    var newBoat = {
        BoatID: randomUUID().toString(),
        BoatName: req.body.BoatName,
        Type: req.body.Type,
        NoOfRooms: req.body.NoOfRooms,
        NoOfBedrooms: req.body.NoOfBedrooms,
        CostPerNight: req.body.CostPerNight,
        ImageURL: req.body.ImageURL,
        Classification: req.body.Classification,
        Verified: req.body.Verified
    }

    // {
    //     "OwnerId":111,
    //     "BoatID": 555,
    //     "BoatName":"ABC",
    //     "Type":"ABC",
    //     "NoOfRooms":2,
    //     "NoOfBedrooms":2,
    //     "CostPerNight":"Rs 2000",
    //     "ImageURL":"ABC/ABC/ABC",
    //     "Classification":"ABC",
    //     "Verified":true
    // }

    console.log(req.user)

    BusinessModel.findOne({ OwnerId: req.user.ownerId }).then((result) => {  //Will work after code change by dipak
        console.log(result)
        var boatArray = result.Boats
        boatArray = [...boatArray, newBoat]
        console.log(boatArray)

        var update = {
            $set: {
                Boats: boatArray
            }
        }

        BusinessModel.findOneAndUpdate({ OwnerId: req.user.ownerId }, update).then((result) => {
            console.log(result)
            res.status(200).json({
                message: "db updated",
                status: "Success"
            })
        })
    })
})

module.exports = router;